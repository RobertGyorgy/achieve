---
// Featured Work Section Component
const featuredProjects = [
  {
    id: 1,
    title: 'Digital Agency',
    slug: 'digital-agency',
    description: 'Modern agency website with immersive design',
    tags: ['Web Design', 'Development', 'Animation'],
    videoUrl: '/Videos/video1.mp4',
  },
  {
    id: 2,
    title: 'E-Commerce Platform',
    slug: 'ecommerce-platform',
    description: 'Full-stack e-commerce solution with advanced features',
    tags: ['E-Commerce', 'Development'],
    videoUrl: '/video 2.mp4',
  },
  {
    id: 3,
    title: 'SaaS Dashboard',
    slug: 'saas-dashboard',
    description: 'Enterprise-grade dashboard with real-time analytics',
    tags: ['SaaS', 'UI/UX Design'],
    videoUrl: '/Videos/orange 1.mp4',
  },
];
---

<div class="relative w-full z-20">
  <section id="featured-work-container" class="relative w-full h-[100svh] bg-[#0d141a] overflow-hidden">
    
    <!-- Static Slice Borders overlay -->
    <div class="absolute inset-0 w-full h-full pointer-events-none z-[40] grid grid-cols-2 md:grid-cols-3">
      <div class="w-full h-full border-r border-white/20"></div>
      <div class="w-full h-full border-r border-white/20 md:border-r-0 lg:border-r lg:border-white/20"></div>
      <div class="w-full h-full hidden md:block"></div>
    </div>

    <!-- Global Transition Mask (Wipes over videos) -->
    <div class="absolute inset-0 w-full h-full pointer-events-none z-[35] grid grid-cols-2 md:grid-cols-3 js-transition-mask">
      <div class="w-full h-full bg-white origin-left mask-slice transform scale-x-0 will-change-transform"></div>
      <div class="w-full h-full bg-white origin-left mask-slice transform scale-x-0 will-change-transform"></div>
      <div class="w-full h-full bg-white origin-left mask-slice transform scale-x-0 will-change-transform hidden md:block"></div>
    </div>

    <div class="absolute inset-0 w-full h-full overflow-hidden js-projects-container">
      {featuredProjects.map((project, index) => (
        <article 
          class={`featured-card absolute inset-0 w-full h-full flex flex-col justify-end will-change-transform z-10 ${index === 0 ? 'opacity-100' : 'opacity-0'}`}
          style={`pointer-events: ${index === 0 ? 'auto' : 'none'};`}
          data-index={index}
        >
          <!-- Base Full-Screen Video -->
          <div class="absolute inset-0 w-full h-full pointer-events-none overflow-hidden z-10">
            <div class="absolute inset-0 opacity-20 z-10" style="background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 40px 40px;"></div>
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent z-20"></div>
            <video 
              src={project.videoUrl}
              class="absolute inset-0 w-full h-full object-cover object-center"
              autoplay
              muted
              loop
              playsinline
            ></video>
          </div>

          <!-- Content (Stays above everything via z-50, but we'll fade it with GSAP) -->
          <div class={`card-content relative z-50 w-full max-w-[90rem] mx-auto flex flex-col gap-6 lg:gap-8 xl:px-12 ${index === 0 ? 'opacity-100' : 'opacity-0'}`} style="margin-bottom: 15vh !important; padding-left: 4vw !important;">
            
            <a href={`/work/${project.slug}`} class="group block w-full max-w-max">
              <div class="flex items-center relative">
                <!-- Hover Arrow (Left Side, No Circle) -->
                <div class="absolute left-0 opacity-0 -translate-x-4 transition-all duration-500 ease-out group-hover:opacity-100 group-hover:translate-x-0 flex items-center">
                  <svg class="w-8 h-8 md:w-10 md:h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                  </svg>
                </div>
                
                <!-- Project Title (Slides Right on Hover) -->
                <h3 class="text-white text-4xl sm:text-5xl md:text-6xl lg:text-7xl xl:text-[5.5rem] font-nura uppercase leading-[0.9] tracking-tight transition-all duration-500 ease-out will-change-transform group-hover:pl-10 md:group-hover:pl-14">
                  {project.title}
                </h3>
              </div>
            </a>
          </div>

          <!-- Full Card Clickable Overlay -->
          <a href={`/work/${project.slug}`} class="absolute inset-0 z-40 w-full h-full block" aria-label={`View ${project.title}`}></a>

        </article>
      ))}
    </div>
  </section>
</div>

<!-- Custom "View Project" Cursor Follower (Matching Hero Drag Tooltip) -->
<div id="view-project-tooltip" class="drag-tooltip">
  View Project
</div>

<style>
  /* Local overrides for the wrapper */
  #featured-work-container {
    box-shadow: 0 -20px 50px rgba(0,0,0,0.1);
  }

  .drag-tooltip {
    position: fixed;
    pointer-events: none;
    z-index: 100000;
    opacity: 0;
    transform: translate(10px, 10px);
    transition:
      opacity 0.2s ease,
      transform 0.2s ease;
    background: #f2f2f2;
    color: #222831;
    padding: 12px 24px;
    border-radius: 9999px;
    font-size: 16px;
    font-weight: 600;
    font-family: 'Nura', serif;
    white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    margin-left: -10px;
    margin-top: 10px;
  }

  .drag-tooltip.visible {
    opacity: 1;
    transform: translate(10px, 10px);
  }
</style>

<script>
  function initViewProjectTooltip() {
    console.log('INIT VIEW PROJECT TOOLTIP CALLED');
    if (window.innerWidth < 1024) return; // Desktop only

    const tooltip = document.getElementById('view-project-tooltip');
    if (!tooltip) {
      console.warn('Tooltip element not found!');
      return;
    }

    // CRITICAL FIX: Move tooltip to document.body to break out of all GSAP/Parent stacking contexts!
    document.body.appendChild(tooltip);

    // Use the container as the trigger for the tooltip
    const container = document.getElementById('featured-work-container');
    if (!container) return;

    const updateTooltipPosition = (e: MouseEvent) => {
      const rect = tooltip.getBoundingClientRect();
      tooltip.style.left = e.clientX + 'px';
      tooltip.style.top = e.clientY + 'px';
      const tooltipWidth = rect.width || 120;
      const tooltipHeight = rect.height || 40;
      const viewportWidth = window.innerWidth;
      const viewportHeight = window.innerHeight;

      if (e.clientX + tooltipWidth + 10 > viewportWidth) {
        tooltip.style.left = viewportWidth - tooltipWidth - 10 + 'px';
      }
      if (e.clientY + tooltipHeight + 10 > viewportHeight) {
        tooltip.style.top = viewportHeight - tooltipHeight - 10 + 'px';
      }
    };

    container.addEventListener('mouseenter', (e: MouseEvent) => {
      tooltip.classList.add('visible');
      updateTooltipPosition(e);
    });

    container.addEventListener('mousemove', (e: MouseEvent) => {
      updateTooltipPosition(e);
    });

    container.addEventListener('mouseleave', () => {
      tooltip.classList.remove('visible');
    });

    container.addEventListener('mousedown', () => {
      tooltip.classList.remove('visible');
    });

    container.addEventListener('mouseup', () => {
      tooltip.classList.add('visible');
    });
  }

  // Run on load and ViewTransitions
  // Because Astro bundles scripts as type="module", DOM is already parsed upon execution.
  initViewProjectTooltip();
  document.addEventListener('astro:page-load', initViewProjectTooltip);
</script>
